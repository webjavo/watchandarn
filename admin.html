</html>
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Panel — Watch & Earn</title>
<style>
:root{
  --bg:#e8f2ff;
  --card:#ffffff;
  --accent:#1e6fdb;
  --accent-2:#0b57b5;
  --muted:#48607f;
  --success:#16a34a;
  --danger:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#14303b}
.container{max-width:480px;margin:0 auto;padding:14px}
.header{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 20px 60px rgba(2,6,23,0.08);margin-top:12px}
.btn{padding:8px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border:none;cursor:pointer;font-weight:700}
.btn-ghost{background:transparent;border:1px solid rgba(20,48,59,0.06);color:var(--accent-2);padding:8px 12px;border-radius:10px;cursor:pointer}
.nav-tabs{display:flex;gap:6px;margin-top:10px}
.tab{flex:1;text-align:center;padding:8px;border-radius:8px;cursor:pointer;background:#f0f6ff;color:var(--accent-2);font-weight:600}
.tab.active{background:var(--accent-2);color:white}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{padding:8px;border-bottom:1px solid rgba(0,0,0,0.05);font-size:13px;text-align:left}
.thumb{width:60px;height:40px;object-fit:cover;border-radius:6px}
.small-input{padding:8px;border-radius:8px;border:1px solid rgba(11,87,181,0.1);width:100px}
</style>
</head>
<body>
<div class="container">
  <h2 style="color:var(--accent-2)">Admin Panel</h2>
  <div id="loginPanel" class="card">
    <h3>Login</h3>
    <input class="small-input" id="ad_user" placeholder="Admin username"/>
    <input class="small-input" id="ad_pass" placeholder="Password" type="password"/>
    <input class="small-input" id="ad_pet" placeholder="Pet name"/>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" id="ad_login">Login</button>
      <button class="btn-ghost" id="ad_cancel">Cancel</button>
    </div>
  </div>

  <div id="adminArea" style="display:none">
    <div class="nav-tabs">
      <div class="tab active" id="tabVideos">Videos</div>
      <div class="tab" id="tabUsers">Users</div>
      <div class="tab" id="tabWithdraw">Withdrawals</div>
    </div>

    <!-- VIDEOS TAB -->
    <div id="videosTab" class="card">
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
        <input class="small-input" id="vid_url" placeholder="YouTube link"/>
        <input class="small-input" id="vid_seconds" placeholder="Seconds"/>
        <input class="small-input" id="vid_coins" placeholder="Coins"/>
        <button class="btn" id="vid_add">Add</button>
      </div>
      <table class="table" id="vid_table">
        <thead><tr><th>Thumbnail</th><th>Seconds</th><th>Coins</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- USERS TAB -->
    <div id="usersTab" class="card" style="display:none">
      <table class="table" id="usersTable">
        <thead><tr><th>Email</th><th>Username</th><th>Balance</th><th>Status</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- WITHDRAWALS TAB -->
    <div id="withdrawTab" class="card" style="display:none">
      <table class="table" id="withdrawTable">
        <thead><tr><th>User</th><th>Amount</th><th>Code</th><th>Time</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzFqbBdIMucN6A7zE6US6aZziyp_3lMB0",
  authDomain: "watchandarn.firebaseapp.com",
  projectId: "watchandarn",
  storageBucket: "watchandarn.firebasestorage.app",
  messagingSenderId: "670181055241",
  appId: "1:670181055241:web:974eabbaff1c2cbf28d1d8",
  measurementId: "G-P1QGG9WV4R"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function qs(id){return document.getElementById(id);}
function alertProfessional(msg){
  const el=document.createElement('div');
  el.style.position='fixed';el.style.left='50%';el.style.top='15%';
  el.style.transform='translateX(-50%)';el.style.zIndex=9999;
  el.style.background='linear-gradient(90deg,#fff7f9,#fff)';
  el.style.padding='12px 18px';el.style.borderRadius='10px';
  el.style.boxShadow='0 10px 30px rgba(0,0,0,0.08)';
  el.innerText=msg;document.body.appendChild(el);
  setTimeout(()=>el.remove(),2200);
}

/* ---- ADMIN LOGIN ---- */
const ADMIN_USER='vmancompany@gmail.com', ADMIN_PASS='242777Aa#', ADMIN_PET='Dragon';
qs('ad_login').addEventListener('click',()=>{
  const u=qs('ad_user').value.trim(),p=qs('ad_pass').value,pet=qs('ad_pet').value.trim();
  if(u===ADMIN_USER && p===ADMIN_PASS && pet===ADMIN_PET){
    qs('loginPanel').style.display='none';
    qs('adminArea').style.display='block';
    loadVideos(); loadUsers(); loadWithdrawals();
  }else alertProfessional('Incorrect credentials');
});

/* ---- TAB SWITCH ---- */
const tabs={tabVideos:'videosTab',tabUsers:'usersTab',tabWithdraw:'withdrawTab'};
Object.keys(tabs).forEach(id=>{
  qs(id).addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    Object.values(tabs).forEach(v=>qs(v).style.display='none');
    qs(tabs[id]).style.display='block';
  });
});

/* ---- LOAD VIDEOS ---- */
async function loadVideos(){
  const tbody=qs('vid_table').querySelector('tbody');
  tbody.innerHTML='';
  const q=query(collection(db,'videos'));
  const snap=await getDocs(q);
  snap.forEach(docu=>{
    const v=docu.data();
    const id=docu.id;
    const vidId=extractYouTubeId(v.url);
    const thumb=`https://img.youtube.com/vi/${vidId}/0.jpg`;
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><img src="${thumb}" class="thumb"></td>
      <td>${v.seconds}</td>
      <td>${v.coins}</td>
      <td>
        <button class='btn-ghost' onclick='removeVideo("${id}")'>Remove</button>
      </td>`;
    tbody.appendChild(tr);
  });
}
async function removeVideo(id){
  await deleteDoc(doc(db,'videos',id));
  alertProfessional('Video removed'); loadVideos();
}
qs('vid_add').addEventListener('click',async()=>{
  const url=qs('vid_url').value.trim();
  const seconds=Number(qs('vid_seconds').value||0);
  const coins=Number(qs('vid_coins').value||0);
  if(!url||seconds<=0||coins<=0){alertProfessional('Invalid');return;}
  await addDoc(collection(db,'videos'),{url,seconds,coins});
  alertProfessional('Video added'); qs('vid_url').value='';qs('vid_seconds').value='';qs('vid_coins').value='';
  loadVideos();
});
function extractYouTubeId(url){const m=url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);return m?m[1]:'';}

/* ---- USERS ---- */
async function loadUsers(){
  const tbody=qs('usersTable').querySelector('tbody'); tbody.innerHTML='';
  const q=query(collection(db,'users'));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const u=d.data(); const id=d.id;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${u.email}</td><td>${u.username}</td><td>₦${u.balance||0}</td>
    <td>${u.disabled?'Disabled':'Active'}</td>
    <td><button class='btn-ghost' onclick='toggleUser("${id}",${!u.disabled})'>Toggle</button></td>`;
    tbody.appendChild(tr);
  });
}
async function toggleUser(id,val){
  await updateDoc(doc(db,'users',id),{disabled:val});
  alertProfessional('User updated'); loadUsers();
}

/* ---- WITHDRAWALS ---- */
async function loadWithdrawals(){
  const tbody=qs('withdrawTable').querySelector('tbody'); tbody.innerHTML='';
  const q=query(collection(db,'withdrawals'),orderBy('time','desc'));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const w=d.data(),id=d.id;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${w.email}</td><td>₦${w.amount}</td><td>${w.code}</td><td>${new Date(w.time).toLocaleString()}</td>
    <td>
      <button class='btn' onclick='markPaid("${id}")'>Paid</button>
      <button class='btn-ghost' onclick='deleteWithdraw("${id}")'>Delete</button>
    </td>`;
    tbody.appendChild(tr);
  });
}
async function markPaid(id){ await updateDoc(doc(db,'withdrawals',id),{status:'paid'}); alertProfessional('Marked as paid'); loadWithdrawals(); }
async function deleteWithdraw(id){ await deleteDoc(doc(db,'withdrawals',id)); alertProfessional('Deleted'); loadWithdrawals(); }
</script>
</body>
</html>
